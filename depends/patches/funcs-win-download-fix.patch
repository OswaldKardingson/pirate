  define fetch_file_inner
    ( mkdir -p $$($(1)_download_dir) || echo "Failed to create download directory" && \
    echo "Fetching $(3) from $(2)" && \
    echo "Download command: $(build_DOWNLOAD) $$($(1)_download_dir)/$(4).temp $(2)/$(3)" && \
    echo "Download directory: $$($(1)_download_dir)" && \
    mkdir -p $$($(1)_download_dir) && \
    curl --connect-timeout 30 --retry 5 --retry-delay 5 --retry-max-time 600 -L -o "$$($(1)_download_dir)/$(4).temp" "$(2)/$(3)" && \
    echo "$(5)  $$($(1)_download_dir)/$(4).temp" > $$($(1)_download_dir)/.$(4).hash && \
     $(build_SHA256SUM) -c $$($(1)_download_dir)/.$(4).hash && \
     mv $$($(1)_download_dir)/$(4).temp $$($(1)_source_dir)/$(4) && \
     rm -rf $$($(1)_download_dir) ) 